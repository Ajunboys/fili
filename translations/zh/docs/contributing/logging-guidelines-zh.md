日志生成规则（Logging Guidelines）
=================================

服务器日志是排错的重要信息，还可以用来检测运行情况。即便日志很有用，我们也不会把所有事情写入日志，因为日志太多会带来处理
的巨大成本，还会影响系统的运行速度。

概述
----

以下列出日志分级和它们代表的含义，具体细节在后文给出。

| 分级  | 含义                                                                                        |
| ----- | ------------------------------------------------------------------------------------------- |
| Error | 系统出错，无法处理请求，这是很严重的问题。                                                  |
| Warn  | 某个地方出错，例如无法缓存。但还是可以正确处理请求，这个问题需要有人来解决一下。            |
| Info  | 系统正常运行，这里主要是用来记录监控系统的运行状况。                                        |
| Debug | 大致的数据处理和报错。可以提供很多细节信息，但是不能太多，每一个请求产生的错误会出现在这里。|
| Trace | 数据处理方面的详细信息。基本上不能在生产环境下使用。                                        |

日志分级
--------

为了平衡日志详尽程度和系统运行速度，Fili 的日志分级机制可以利用日志分级控制那些日志会被写入。这里介绍一下什么样的日志
要被写入哪一级日志。这些规则适用于 Fili 的所有代码。

### Error

当 Fili 无法正常运行，处理请求的时候。正常情况下，Fili 不会出现 `Error` 级别的日志。Fili 一旦显示了 `Error` 级别的日志，
那应该代表出现了严重错误，据一些例子：

- 配置出错，导致应用无法正常运行。
- 一个未知的系统错误，访问得到 500 类型的 HTTP状态码。
  
  但这个系统错误是可能发生，而且不是用户导致的的 500 类型的 HTTP状态码的话，此类事件不应该用 `Error` 级别的日志。例如，
  `503 Service Unavailable`，可能原因是维度元数据（dimension metadata）没有加载；还有比如 `507 Insufficient Storage`，这
  代表请求耗费了太多硬件资源。

### Warn

某个地方出错，但还是可以正确处理请求，正常情况下，Fili 可以出现 `Warn` 级别的日志。Fili 显示了 `Warn` 级别的日志，不一定
就是严重错误，但这个问题需要有人来解决一下。举例：

- 配置出错，然而还是可以正确处理请求，但是处理方式不是最佳的，可能出现一些隐患。
- 应用按照指示启动，但是某些配置出错，只能用默认配置了，导致的结果就是没有按照指定状态运行。
- 非关键性服务停止运行或出现故障。某些问题只是暂时的，但某些不是。

  例如，Druid 响应缓存报错或者请求超时，这种情况下 Fili 还是能正确处理请求，但因为没有了缓存，运行会变慢。

### Info

处理 HTTP 请求，显示处理情况和状态；用于记录非持续性事件和 Fili 的运行状态。生产环境下 Fili 可以使用 `Info` 级别的日志，
使用的地方应该是检测，检查应用是否正常运行，使用情况如何。

- 启动或关闭的相关信息（关启主要组件成功与否）
- 处理每个请求用的时间和状态查看

### Debug

大致的数据处理和请求处理步骤，故障排错就需要用到 `Debug` 级别日志。此类日志需要给出足够详细的信息，但又不能过多。

不过正常和程序主逻辑下的请求处理不应该用 `Debug` 日志，因为很多信息都是关于正常的处理请求。以下情况是需要用 `Debug` 日志
的：

- 因为用户导致的请求失败，例如时间参数格式错误或其他类似错误。
- 单次请求信息，例如那个物理列表被选中用来提供数据。
- 关启应用时候出现的故障。
- 应用运行时候出现的故障。

### Trace

数据处理方面的详细信息。基本上不能在生产环境下使用。用来记录处理请求时候的各项详尽信息。

- 处理请求时候的各项详尽信息。
- 大小循环执行情况（应用启动，非请求方面，请求处理）。
    - 如果循环要求很快运行或者经常被执行，考虑把日志放到循环外面，以免降低系统运行速度。
